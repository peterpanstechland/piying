# 故障排除指南

## 前端检测不工作

### 检查清单

#### 1. 浏览器控制台检查
按 F12 打开开发者工具，查看 Console 标签页是否有错误：

**常见错误及解决方案：**

- **摄像头权限被拒绝**
  ```
  NotAllowedError: Permission denied
  ```
  解决：点击地址栏左侧的摄像头图标，允许访问摄像头

- **MediaPipe 加载失败**
  ```
  Failed to load resource: net::ERR_INTERNET_DISCONNECTED
  ```
  解决：检查网络连接，MediaPipe 需要从 CDN 加载模型

- **后端连接失败**
  ```
  Failed to fetch
  ```
  解决：确保后端服务器正在运行（http://localhost:8000）

#### 2. 摄像头权限检查

**Windows 系统设置：**
1. 打开 设置 > 隐私和安全性 > 摄像头
2. 确保"允许应用访问你的摄像头"已开启
3. 确保浏览器（Chrome/Edge）有摄像头权限

**浏览器权限：**
1. 点击地址栏左侧的锁图标
2. 找到"摄像头"权限
3. 设置为"允许"
4. 刷新页面

#### 3. 摄像头占用检查

确保没有其他程序占用摄像头：
- 关闭 Zoom、Teams、Skype 等视频会议软件
- 关闭其他使用摄像头的浏览器标签页
- 重启浏览器

#### 4. 后端服务检查

确认后端正在运行：
```cmd
# 在浏览器访问
http://localhost:8000/docs
```

应该能看到 FastAPI 的 API 文档页面。

如果无法访问：
- 检查后端终端窗口是否有错误
- 确认端口 8000 没有被其他程序占用
- 重启后端服务

#### 5. 网络连接检查

MediaPipe 需要从 CDN 加载模型文件：
- 确保有网络连接
- 如果在内网环境，可能需要配置代理
- 检查防火墙是否阻止了 CDN 访问

#### 6. 浏览器兼容性

推荐使用：
- Chrome 90+
- Edge 90+
- Firefox 88+

不支持：
- IE 浏览器
- 旧版本浏览器

### 调试步骤

#### 步骤 1：检查摄像头是否工作
1. 打开 https://webcamtests.com/
2. 允许摄像头权限
3. 确认能看到摄像头画面

如果这里不工作，说明是摄像头或系统权限问题，与本系统无关。

#### 步骤 2：检查后端连接
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签页
3. 刷新页面
4. 查看是否有红色的请求失败

如果看到 `http://localhost:8000/config/scenes.json` 失败，说明后端未启动。

#### 步骤 3：查看详细日志
在浏览器控制台输入：
```javascript
localStorage.setItem('debug', 'true');
location.reload();
```

这会启用详细日志输出，帮助定位问题。

#### 步骤 4：测试 MediaPipe 加载
在浏览器控制台输入：
```javascript
fetch('https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.binarypb')
  .then(r => console.log('MediaPipe CDN accessible:', r.ok))
  .catch(e => console.error('MediaPipe CDN error:', e));
```

如果返回错误，说明无法访问 MediaPipe CDN。

### 常见问题

#### Q: 页面一直显示"等待检测"
**A:** 可能原因：
1. 摄像头权限未授予 - 检查浏览器地址栏左侧的权限图标
2. 距离摄像头太远 - 站近一些，确保全身在画面内
3. 光线太暗 - 增加环境光线
4. MediaPipe 未加载完成 - 等待 5-10 秒让模型加载

#### Q: 检测到人但无法选择场景
**A:** 可能原因：
1. 手势未被识别 - 确保右手清晰可见
2. 手的位置不对 - 将手移到场景图标上方
3. 手部检测模型未加载 - 刷新页面重试

#### Q: 录制时提示"多人警告"
**A:** 确保画面中只有一个人。如果确实只有一人：
1. 检查背景是否有人形物体（海报、镜子等）
2. 调整摄像头角度
3. 改善光线条件

#### Q: 视频生成失败
**A:** 检查：
1. 后端终端是否有错误信息
2. `data/outputs/` 目录是否有写入权限
3. 磁盘空间是否充足（至少 1GB 可用）

### 性能问题

#### 检测延迟高（>200ms）
1. 关闭其他占用 CPU 的程序
2. 降低摄像头分辨率（修改代码中的 1280x720 为 640x480）
3. 确保电脑性能满足要求（8GB+ 内存）

#### 帧率低（<20 FPS）
1. 检查 CPU 使用率
2. 关闭浏览器其他标签页
3. 更新显卡驱动

### 获取技术支持

如果以上方法都无法解决问题，请提供以下信息：

1. 浏览器版本（在地址栏输入 `chrome://version` 或 `edge://version`）
2. 操作系统版本
3. 浏览器控制台的完整错误信息（截图）
4. 后端终端的错误信息（如果有）
5. 问题复现步骤

## 快速重启

如果系统出现异常，可以快速重启：

1. 关闭所有终端窗口
2. 关闭浏览器标签页
3. 重新运行 `start-dev.bat` 或 `start-production.bat`
4. 刷新浏览器页面并重新授予摄像头权限
